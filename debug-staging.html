<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Staging Widget</title>
  <style>
    body {
      margin: 40px;
      font-family: Arial, sans-serif;
    }
    .debug-console {
      background: #000;
      color: #0f0;
      padding: 20px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 13px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 20px;
    }
    .debug-line {
      margin: 2px 0;
    }
    .error { color: #f00; }
    .info { color: #0ff; }
    .success { color: #0f0; }
  </style>
</head>
<body>
  <h1>Debug: Foster Village Widget (Staging)</h1>
  <p>This page monitors the widget loading process and configuration.</p>
  
  <div id="debug-console" class="debug-console">
    <div class="debug-line">Starting debug session...</div>
  </div>

  <script>
    const debugLog = (message, type = 'info') => {
      const console = document.getElementById('debug-console');
      const line = document.createElement('div');
      line.className = `debug-line ${type}`;
      line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      console.appendChild(line);
      console.scrollTop = console.scrollHeight;
    };

    // Override console methods to capture logs
    const originalLog = console.log;
    const originalError = console.error;
    
    console.log = function(...args) {
      originalLog.apply(console, args);
      debugLog('LOG: ' + args.join(' '), 'info');
    };
    
    console.error = function(...args) {
      originalError.apply(console, args);
      debugLog('ERROR: ' + args.join(' '), 'error');
    };

    // Monitor network requests
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
      const url = args[0];
      debugLog(`FETCH: ${url}`, 'info');
      
      return originalFetch.apply(this, args)
        .then(response => {
          debugLog(`RESPONSE: ${url} - Status: ${response.status}`, response.ok ? 'success' : 'error');
          
          // Clone response to read it
          const cloned = response.clone();
          if (url.includes('get_config')) {
            cloned.json().then(data => {
              debugLog(`CONFIG: ${JSON.stringify(data).substring(0, 200)}...`, 'success');
            }).catch(err => {
              debugLog(`CONFIG PARSE ERROR: ${err.message}`, 'error');
            });
          }
          
          return response;
        })
        .catch(error => {
          debugLog(`FETCH ERROR: ${url} - ${error.message}`, 'error');
          throw error;
        });
    };

    debugLog('Loading widget from staging...', 'info');
    debugLog('Expected tenant hash: fo85e6a06dcdf4', 'info');
  </script>

  <!-- Load the staging widget -->
  <script src="https://chat.myrecruiter.ai/staging/widget.js" data-tenant="fo85e6a06dcdf4"></script>
  
  <script>
    // Monitor widget initialization
    setTimeout(() => {
      const iframe = document.querySelector('#picasso-widget-iframe');
      if (iframe) {
        debugLog('Widget iframe found!', 'success');
        debugLog(`Iframe src: ${iframe.src}`, 'info');
        
        // Try to access iframe content (may be blocked by CORS)
        try {
          const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
          debugLog('Iframe document accessible', 'success');
        } catch (e) {
          debugLog('Cannot access iframe content (CORS)', 'info');
        }
      } else {
        debugLog('Widget iframe not found!', 'error');
      }
      
      // Check for widget container
      const container = document.querySelector('#picasso-widget-container');
      if (container) {
        debugLog('Widget container found', 'success');
        debugLog(`Container styles: width=${container.style.width}, height=${container.style.height}`, 'info');
      }
    }, 3000);
  </script>
</body>
</html>