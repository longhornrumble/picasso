[tool:pytest]
# Pytest configuration for PICASSO tenant inference system
# Healthcare-grade testing configuration

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Minimum version
minversion = 7.4.0

# Add options
addopts = 
    # Coverage reporting
    --cov=tenant_inference
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-report=term-missing
    --cov-fail-under=90
    
    # Test output formatting
    --verbose
    --tb=short
    --strict-markers
    --strict-config
    
    # Parallel execution (adjust based on system capabilities)
    -n auto
    
    # Performance and timeout
    --timeout=60
    --timeout-method=thread
    
    # HTML report generation
    --html=reports/pytest_report.html
    --self-contained-html
    
    # JSON report for CI/CD integration
    --json-report --json-report-file=reports/pytest_report.json
    
    # Show slowest tests
    --durations=10
    
    # Warnings configuration
    -W ignore::DeprecationWarning
    -W ignore::PendingDeprecationWarning
    -W error::UserWarning

# Test markers for categorization
markers =
    unit: Unit tests for individual functions
    integration: Integration tests for full workflows
    security: Security and penetration testing
    performance: Performance and load testing
    healthcare: Healthcare compliance testing
    aws: Tests requiring AWS service mocking
    jwt: JWT token validation tests
    slow: Tests that take more than 5 seconds
    critical: Critical path tests that must always pass
    compliance: HIPAA and healthcare compliance tests
    audit: Audit logging and tracking tests
    rate_limit: Rate limiting functionality tests
    fail_closed: Fail-closed security behavior tests
    edge_case: Edge case and error handling tests
    regression: Regression tests for known issues

# Timeout configuration
timeout = 60
timeout_method = thread

# Coverage configuration
[coverage:run]
source = .
omit = 
    */tests/*
    */test_*
    */__pycache__/*
    */venv/*
    */env/*
    */conftest.py
    */fixtures.py
    setup.py
    */migrations/*

[coverage:report]
# Fail if coverage is below threshold
fail_under = 90

# Show missing lines
show_missing = true

# Exclude lines from coverage
exclude_lines =
    pragma: no cover
    def __repr__
    if self.debug:
    if settings.DEBUG
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:
    class .*\bProtocol\):
    @(abc\.)?abstractmethod

# Precision for coverage reporting
precision = 2

[coverage:html]
directory = htmlcov
title = PICASSO Tenant Inference - Test Coverage Report

[coverage:xml]
output = coverage.xml