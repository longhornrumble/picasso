<!DOCTYPE html>
<html>
<head>
    <title>Rollup Staging Widget Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-info { background: #e8f4fd; padding: 15px; margin: 20px 0; border-radius: 5px; border-left: 4px solid #2196f3; }
        .success { background: #e8f5e8; border-left-color: #4caf50; }
        .error { background: #ffeaea; border-left-color: #f44336; }
    </style>
</head>
<body>
    <h1>üöÄ Vite Staging Widget Test</h1>
    
    <div class="test-info">
        <h3>Build System: Fresh Vite (Replaced Rollup)</h3>
        <p><strong>Environment:</strong> Staging</p>
        <p><strong>Tenant Hash:</strong> my87674d777bf9</p>
        <p><strong>Lambda URL:</strong> https://xkjbyi3ushhuiytcfbuk5uaqom0ivhfk.lambda-url.us-east-1.on.aws</p>
        <p><strong>Widget Script:</strong> ./dist/staging/assets/widget.js</p>
        <p><strong>Iframe HTML:</strong> ./dist/staging/iframe.html</p>
    </div>
    
    <p>Testing the new Vite build system. The chat widget should appear in the bottom right corner.</p>
    
    <p><strong>Expected Behavior:</strong></p>
    <ul>
        <li>Widget loads from Vite-built files</li>
        <li>DOMPurify security working properly</li>
        <li>Environment variables injected at build time</li>
        <li>Chat connects to staging Lambda endpoints</li>
        <li>All CSS and assets load correctly</li>
    </ul>

    <div id="test-status" class="test-info">
        <h3>Test Status:</h3>
        <p id="widget-status">‚è≥ Loading widget...</p>
        <p id="iframe-status">‚è≥ Waiting for iframe...</p>
        <p id="config-status">‚è≥ Waiting for config...</p>
    </div>
    
    <!-- Load the Rollup-built staging widget -->
    <script src="./dist/staging/assets/widget.js" data-tenant="my87674d777bf9"></script>
    
    <script>
        // Test widget loading
        setTimeout(() => {
            const widget = window.PicassoWidget;
            const widgetStatus = document.getElementById('widget-status');
            const iframeStatus = document.getElementById('iframe-status');
            
            if (widget) {
                widgetStatus.innerHTML = '‚úÖ Widget script loaded successfully';
                widgetStatus.parentElement.className = 'test-info success';
                
                // Check if iframe exists
                const iframe = document.querySelector('#picasso-widget-container iframe');
                if (iframe) {
                    iframeStatus.innerHTML = '‚úÖ Iframe created: ' + iframe.src;
                } else {
                    iframeStatus.innerHTML = '‚ùå Iframe not found';
                }
            } else {
                widgetStatus.innerHTML = '‚ùå Widget script failed to load';
                widgetStatus.parentElement.className = 'test-info error';
            }
        }, 2000);
        
        // Listen for widget events
        window.addEventListener('message', (event) => {
            if (event.data.type === 'PICASSO_EVENT') {
                console.log('üì¢ Widget Event:', event.data);
                
                if (event.data.event === 'CONFIG_LOADED') {
                    const configStatus = document.getElementById('config-status');
                    configStatus.innerHTML = '‚úÖ Config loaded successfully';
                }
            }
        });
        
        console.log('üß™ Vite staging test page loaded');
        console.log('üìç Testing fresh Vite build system with staging environment');
    </script>
</body>
</html>