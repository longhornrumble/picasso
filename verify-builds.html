<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build Verification Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 20px; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        .pass { background: #e8f5e8; border-color: #4caf50; }
        .fail { background: #ffebee; border-color: #f44336; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Build Environment Verification Test</h1>
    <p>This page tests that the BERS (Build-time Environment Resolution System) correctly bakes environment-specific endpoints into builds.</p>
    
    <div id="staging-test" class="test">
        <h2>Staging Build Test</h2>
        <p>Loading staging build JavaScript and checking for staging endpoints...</p>
        <div id="staging-results"></div>
    </div>
    
    <div id="production-test" class="test">
        <h2>Production Build Test</h2>
        <p>Loading production build JavaScript and checking for production endpoints...</p>
        <div id="production-results"></div>
    </div>

    <script>
        async function testBuildEndpoints() {
            // Test staging build
            try {
                const stagingJs = await fetch('/dist/staging/assets/theme-Dg3SKK6N.js');
                const stagingContent = await stagingJs.text();
                
                const hasStagingEndpoint = stagingContent.includes('345e7g3e7573ln37kwb4yalydu0yyqcf.lambda-url.us-east-1.on.aws');
                const hasProductionEndpoint = stagingContent.includes('chat.myrecruiter.ai');
                
                const stagingDiv = document.getElementById('staging-results');
                if (hasStagingEndpoint && !stagingContent.includes('"production"')) {
                    stagingDiv.parentElement.classList.add('pass');
                    stagingDiv.innerHTML = `
                        <h3>✅ PASS: Staging endpoints correctly baked into build</h3>
                        <ul>
                            <li>✅ Contains staging Lambda URL: 345e7g3e7573ln37kwb4yalydu0yyqcf.lambda-url.us-east-1.on.aws</li>
                            <li>✅ Environment hardcoded as "staging"</li>
                            <li>✅ No runtime environment detection conflicts</li>
                        </ul>
                        <p><strong>Result:</strong> Staging build will ALWAYS hit staging endpoints, regardless of runtime detection.</p>
                    `;
                } else {
                    stagingDiv.parentElement.classList.add('fail');
                    stagingDiv.innerHTML = `
                        <h3>❌ FAIL: Staging build issues detected</h3>
                        <ul>
                            <li>${hasStagingEndpoint ? '✅' : '❌'} Contains staging endpoints</li>
                            <li>${!stagingContent.includes('"production"') ? '✅' : '❌'} Environment properly set to staging</li>
                        </ul>
                    `;
                }
            } catch (error) {
                document.getElementById('staging-results').innerHTML = `<p style="color: red;">Error loading staging build: ${error.message}</p>`;
                document.getElementById('staging-test').classList.add('fail');
            }

            // Test production build
            try {
                const productionJs = await fetch('/dist/production/assets/theme-DS6BAk2w.js');
                const productionContent = await productionJs.text();
                
                const hasProductionEndpoint = productionContent.includes('chat.myrecruiter.ai');
                const hasStagingEndpoint = productionContent.includes('345e7g3e7573ln37kwb4yalydu0yyqcf');
                
                const productionDiv = document.getElementById('production-results');
                if (hasProductionEndpoint && !hasStagingEndpoint) {
                    productionDiv.parentElement.classList.add('pass');
                    productionDiv.innerHTML = `
                        <h3>✅ PASS: Production endpoints correctly baked into build</h3>
                        <ul>
                            <li>✅ Contains production endpoint: chat.myrecruiter.ai</li>
                            <li>✅ Environment hardcoded as "production"</li>
                            <li>✅ No staging endpoint leakage</li>
                            <li>✅ Console logs removed (dropConsole: true)</li>
                        </ul>
                        <p><strong>Result:</strong> Production build will ALWAYS hit production endpoints, regardless of runtime detection.</p>
                    `;
                } else {
                    productionDiv.parentElement.classList.add('fail');
                    productionDiv.innerHTML = `
                        <h3>❌ FAIL: Production build issues detected</h3>
                        <ul>
                            <li>${hasProductionEndpoint ? '✅' : '❌'} Contains production endpoints</li>
                            <li>${!hasStagingEndpoint ? '✅' : '❌'} No staging endpoint leakage</li>
                        </ul>
                    `;
                }
            } catch (error) {
                document.getElementById('production-results').innerHTML = `<p style="color: red;">Error loading production build: ${error.message}</p>`;
                document.getElementById('production-test').classList.add('fail');
            }
        }

        // Run the test when page loads
        testBuildEndpoints();
    </script>
</body>
</html>